!function(e){var t=[];"undefined"==typeof MediaStreamTrack||void 0===MediaStreamTrack.getSources?navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(function(e){e.forEach(function(e){"videoinput"===e.kind&&t.push(e.deviceId)})}).catch(function(e){console.error(e.name+": "+e.message)}):console.log("enumerateDevices() and MediaStreamTrack.getSources() not supported."):MediaStreamTrack.getSources(function(e){for(var a=0;a!==e.length;++a){var o=e[a];"video"===o.kind&&t.push(o.id)}}),jQuery.fn.extend({html5_qrcode:function(a,o,i,r){return this.each(function(){var n=e(this);e.data(n[0],"qrcodeSuccess",a),e.data(n[0],"qrcodeError",o),e.data(n[0],"videoError",i),void 0!==r&&void 0!==t[r]?e.data(n[0],"sourceId",r):e.data(n[0],"sourceId",0),void 0!==t[n.data("sourceId")]&&e.data(n[0],"cameraId",t[n.data("sourceId")]);var d=n.height(),c=n.width();null==d&&(d=250),null==c&&(c=300);var s,u=e('<video width="'+c+'px" height="'+d+'px"></video>').appendTo(n),h=e('<canvas id="qr-canvas" width="'+(c-2)+'px" height="'+(d-2)+'px" style="display:none;"></canvas>').appendTo(n),v=u[0],m=h[0].getContext("2d"),l=function(){if(s){m.drawImage(v,0,0,307,250);try{qrcode.decode()}catch(e){o(e,s)}e.data(n[0],"timeout",setTimeout(l,500))}else e.data(n[0],"timeout",setTimeout(l,500))};window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;if(navigator.getUserMedia){var g={video:!0};void 0!==n.data("cameraId")&&(g={video:{optional:[{sourceId:n.data("cameraId")}]}}),navigator.getUserMedia(g,function(t){v.srcObject=t,s=t,e.data(n[0],"stream",t),v.play(),e.data(n[0],"timeout",setTimeout(l,1e3))},function(e){"function"==typeof i?i(e,s):console.log("Error callback is undefined or not a function.")})}else console.log("Native web camera streaming (getUserMedia) not supported in this browser.");qrcode.callback=function(e){"function"==typeof a?a(e,s):console.log("Success callback is undefined or not a function.")}})},html5_qrcode_stop:function(){return this.each(function(){e(this).data("stream").getVideoTracks().forEach(function(e){e.stop()}),e(this).children("video").remove(),e(this).children("canvas").remove(),clearTimeout(e(this).data("timeout"))})},html5_qrcode_changeCamera:function(){return this.each(function(){e(this).html5_qrcode_stop(),e(this).html5_qrcode(e(this).data("qrcodeSuccess"),e(this).data("qrcodeError"),e(this).data("videoError"),(e(this).data("sourceId")+1)%t.length)})},html5_qrcode_cameraCount:function(){return t.length}})}(jQuery);
