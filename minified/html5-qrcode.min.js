!function(e){var a=[];"undefined"==typeof MediaStreamTrack||void 0===MediaStreamTrack.getSources?(console.info("MediaStreamTrack undefined"),navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?(console.info("mediaDevices available"),navigator.mediaDevices.enumerateDevices().then(function(e){e.forEach(function(e){"videoinput"===e.kind&&a.push(e.deviceId)})}).catch(function(e){console.error(e.name+": "+e.message)})):console.log("enumerateDevices() and MediaStreamTrack.getSources() not supported.")):MediaStreamTrack.getSources(function(e){for(var t=0;t!==e.length;++t){var o=e[t];"video"===o.kind&&a.push(o.id)}}),jQuery.fn.extend({html5_qrcode:function(t,o,i,n){return this.each(function(){var r=e(this);e.data(r[0],"qrcodeSuccess",t),e.data(r[0],"qrcodeError",o),e.data(r[0],"videoError",i),void 0!==n&&void 0!==a[n]?e.data(r[0],"sourceId",n):e.data(r[0],"sourceId",0),void 0!==a[r.data("sourceId")]&&e.data(r[0],"cameraId",a[r.data("sourceId")]);var d=r.height(),c=r.width();null==d&&(d=250),null==c&&(c=300);var s,u=e('<video width="'+c+'px" height="'+d+'px" playsinline autoplay></video>').appendTo(r),v=e('<canvas id="qr-canvas" width="'+(c-2)+'px" height="'+(d-2)+'px" style="display:none;"></canvas>').appendTo(r),h=u[0],m=v[0].getContext("2d"),l=function(){if(s){m.drawImage(h,0,0,307,250);try{qrcode.decode()}catch(e){o(e,s)}e.data(r[0],"timeout",setTimeout(l,500))}else e.data(r[0],"timeout",setTimeout(l,500))};window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;if(navigator.getUserMedia){var f={video:!0};void 0!==r.data("cameraId")&&(f={video:{deviceId:{exact:r.data("cameraId")}}}),navigator.getUserMedia(f,function(a){h.srcObject=a,s=a,e.data(r[0],"stream",a),h.play(),e.data(r[0],"timeout",setTimeout(l,1e3))},function(e){"function"==typeof i?i(e,s):console.log("Error callback is undefined or not a function.")})}else console.log("Native web camera streaming (getUserMedia) not supported in this browser.");qrcode.callback=function(e){"function"==typeof t?t(e,s):console.log("Success callback is undefined or not a function.")}})},html5_qrcode_stop:function(){return this.each(function(){e(this).data("stream").getVideoTracks().forEach(function(e){e.stop()}),e(this).children("video").remove(),e(this).children("canvas").remove(),clearTimeout(e(this).data("timeout"))})},html5_qrcode_changeCamera:function(){return this.each(function(){e(this).html5_qrcode_stop(),e(this).html5_qrcode(e(this).data("qrcodeSuccess"),e(this).data("qrcodeError"),e(this).data("videoError"),(e(this).data("sourceId")+1)%a.length)})},html5_qrcode_cameraCount:function(){return a.length}})}(jQuery);
